# Принцип инверсии зависимостей

Разрабатываем веб-приложение, которое умеет:

1. Строить маршрут между двумя точками.
2. Расчитывать стоимость поездки по маршруту.

Мы будем обращаться к внешним сервисам для того, чтобы строить маршрут. Для начала применим Google Maps Directions API.

Для иллюстрации напишем код на JavaScript, чтобы его можно было запускать из браузера. К сожалению, Google Maps Directions API
не поддерживает CORS и не позволяет обращаться к сервису с произвольных страниц. Чтобы обойти это ограничение, мы задействуем
сервисом [CORS anywhere](http://cors-anywhere.herokuapp.com/).

Для тестирования кода вы должны зарегистрироваться в Google как разработчик, и сгенерировать ключ в [Диспетчере API](https://console.developers.google.com/apis/library).

Чтобы построить маршрут, мы будем посылать GET-запрос вида

    http://cors-anywhere.herokuapp.com/maps.googleapis.com:443/maps/api/directions/json?origin={from}&destination={to}&key={key}

Здесь `from`&nbsp;&mdash; адрес отправления, `to`&nbsp;&mdash; адрес назначения, и `key`&nbsp;&mdash; ключ, полученный в Диспетчере API.
Сервис возвращает JSON-объект, в котором нас интересуют только часть полей, а именно:

    {
      routes: [
        {
          legs: [
            {
              steps: [
                {
                  distance: {
                    value: 123,
                  },
                  duration: {
                    value: 32
                  }
                },
                {
                  distance: {
                    value: 76,
                  },
                  duration: {
                    value: 21
                  }
                },
                . . .
              ]
            },
            {
              steps: [
                {
                  distance: {
                    value: 123,
                  },
                  duration: {
                    value: 32
                  }
                },
                {
                  distance: {
                    value: 76,
                  },
                  duration: {
                    value: 21
                  }
                },
                . . .
              ]
            },
            . . .
          ]
        },
        . . .
      ]
    }

Directions API возвращает массив объектов `routes`, поскольку мы можем попросить несколько маршрутов на выбор. Но мы не просим, поэтому этот массив
всегда содержит только один элемент. Маршрут состоит из массива участков `legs`, в котором тоже только один элемент, потому что мы не задавали промежуточных
точек. Наконец, участок содержит массив шагов `steps`. Для каждого шага мы можем узнать длину в метрах (`distance.value`) и продолжительность в секундах
(`duration.value`).

